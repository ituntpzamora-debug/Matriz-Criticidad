<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Matriz de Criticidad — Planta Cerámica Marcos Paz</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0e1117;
    --surface: #161b27;
    --surface2: #1e2535;
    --border: #2a3350;
    --text: #e8eaf2;
    --text-dim: #7a839e;
    --A: #ff3b5c;
    --B: #ffaa00;
    --C: #00d68f;
    --A-glow: rgba(255,59,92,0.3);
    --B-glow: rgba(255,170,0,0.3);
    --C-glow: rgba(0,214,143,0.3);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(var(--border) 1px, transparent 1px),
      linear-gradient(90deg, var(--border) 1px, transparent 1px);
    background-size: 40px 40px;
    opacity: 0.3;
    pointer-events: none;
    z-index: 0;
  }

  .wrapper {
    position: relative;
    z-index: 1;
    max-width: 1440px;
    margin: 0 auto;
    padding: 32px 24px;
  }

  /* Header */
  header {
    display: flex;
    align-items: center;
    gap: 24px;
    margin-bottom: 40px;
    padding-bottom: 24px;
    border-bottom: 1px solid var(--border);
  }

  .logo-block {
    background: linear-gradient(135deg, #ff3b5c, #ff8c00);
    width: 56px; height: 56px;
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 20px;
    color: white;
    flex-shrink: 0;
    box-shadow: 0 0 30px rgba(255,59,92,0.4);
  }

  .title-block h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(28px, 4vw, 48px);
    letter-spacing: 2px;
    line-height: 1;
    background: linear-gradient(90deg, #fff 60%, #7a839e);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .title-block p {
    font-size: 13px;
    color: var(--text-dim);
    margin-top: 4px;
    letter-spacing: 0.5px;
  }

  /* Stats */
  .stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
    gap: 12px;
    margin-bottom: 28px;
  }

  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    transition: border-color 0.2s;
  }

  .stat-card.A { border-color: var(--A); box-shadow: 0 0 20px var(--A-glow); }
  .stat-card.B { border-color: var(--B); box-shadow: 0 0 20px var(--B-glow); }
  .stat-card.C { border-color: var(--C); box-shadow: 0 0 20px var(--C-glow); }

  .stat-num { font-family: 'Bebas Neue', sans-serif; font-size: 36px; line-height: 1; }
  .stat-card.A .stat-num { color: var(--A); }
  .stat-card.B .stat-num { color: var(--B); }
  .stat-card.C .stat-num { color: var(--C); }

  .stat-label { font-size: 11px; color: var(--text-dim); letter-spacing: 1px; text-transform: uppercase; }
  .stat-badge {
    display: inline-flex; align-items: center; justify-content: center;
    width: 22px; height: 22px; border-radius: 6px;
    font-size: 11px; font-weight: 600; margin-bottom: 4px;
  }
  .badge-A { background: var(--A); color: white; }
  .badge-B { background: var(--B); color: #0e1117; }
  .badge-C { background: var(--C); color: #0e1117; }

  /* Filters */
  .filters {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 24px;
    align-items: center;
  }

  .filter-label {
    font-size: 11px; text-transform: uppercase; letter-spacing: 1px;
    color: var(--text-dim); margin-right: 4px;
  }

  .filter-btn {
    background: var(--surface); border: 1px solid var(--border);
    color: var(--text-dim); padding: 6px 14px; border-radius: 20px;
    cursor: pointer; font-size: 12px; font-family: 'DM Sans', sans-serif;
    transition: all 0.15s; white-space: nowrap;
  }

  .filter-btn:hover { border-color: #4a5380; color: var(--text); }
  .filter-btn.active { background: var(--surface2); border-color: #6b7db3; color: var(--text); font-weight: 500; }
  .filter-btn.active-A { background: rgba(255,59,92,0.15); border-color: var(--A); color: var(--A); }
  .filter-btn.active-B { background: rgba(255,170,0,0.15); border-color: var(--B); color: var(--B); }
  .filter-btn.active-C { background: rgba(0,214,143,0.15); border-color: var(--C); color: var(--C); }

  /* Main grid */
  .main-grid {
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: 20px;
    margin-bottom: 24px;
  }

  @media (max-width: 900px) { .main-grid { grid-template-columns: 1fr; } }

  .chart-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    position: relative;
  }

  .card-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 18px; letter-spacing: 1.5px;
    color: var(--text-dim); margin-bottom: 16px; text-transform: uppercase;
  }

  .chart-wrap { position: relative; height: 480px; }

  .heat-legend { display: flex; gap: 12px; margin-top: 12px; flex-wrap: wrap; }
  .heat-item { display: flex; align-items: center; gap: 6px; font-size: 11px; color: var(--text-dim); }
  .heat-dot { width: 10px; height: 10px; border-radius: 50%; }

  /* Side panel */
  .side-panel { display: flex; flex-direction: column; gap: 16px; }

  .heatmap-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 16px; padding: 20px; flex: 1;
  }

  .heat-matrix {
    display: grid;
    grid-template-columns: 20px repeat(5, 1fr);
    grid-template-rows: repeat(5, 1fr) 20px;
    gap: 3px;
    height: 200px;
    margin-top: 12px;
  }

  .hm-cell {
    border-radius: 4px;
    display: flex; align-items: center; justify-content: center;
    font-size: 10px; font-weight: 600;
    cursor: default; transition: transform 0.1s; position: relative;
  }

  .hm-cell:hover { transform: scale(1.1); z-index: 2; }
  .hm-axis { display: flex; align-items: center; justify-content: center; font-size: 9px; color: var(--text-dim); font-weight: 600; }
  .hm-axis.y { writing-mode: vertical-rl; text-orientation: mixed; }

  /* Tooltip */
  #tooltip {
    position: fixed;
    background: #1e2535; border: 1px solid #3a4560;
    border-radius: 10px; padding: 12px 14px;
    font-size: 12px; pointer-events: none; display: none;
    z-index: 1000; max-width: 230px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  }

  #tooltip .tt-tag { font-family: 'Bebas Neue', sans-serif; font-size: 16px; letter-spacing: 1px; }
  #tooltip .tt-name { color: var(--text-dim); margin-bottom: 8px; font-size: 11px; line-height: 1.3; }
  #tooltip .tt-row {
    display: flex; justify-content: space-between; gap: 12px;
    padding: 3px 0; border-bottom: 1px solid var(--border); font-size: 11px;
  }
  #tooltip .tt-row:last-child { border-bottom: none; }
  #tooltip .tt-key { color: var(--text-dim); }
  #tooltip .tt-val { font-weight: 600; }

  /* Table */
  .table-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 16px; padding: 24px; overflow: hidden;
  }

  .table-header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 16px; flex-wrap: wrap; gap: 8px;
  }

  .search-box {
    background: var(--surface2); border: 1px solid var(--border);
    color: var(--text); padding: 7px 12px; border-radius: 8px;
    font-size: 12px; font-family: 'DM Sans', sans-serif; width: 220px;
    outline: none; transition: border-color 0.15s;
  }

  .search-box:focus { border-color: #5a6a9e; }
  .search-box::placeholder { color: var(--text-dim); }

  .tbl-count { font-size: 12px; color: var(--text-dim); }

  .table-wrap { overflow: auto; max-height: 380px; }

  table { width: 100%; border-collapse: collapse; font-size: 12px; }

  thead th {
    background: var(--surface2); color: var(--text-dim);
    text-transform: uppercase; letter-spacing: 0.8px; font-size: 10px;
    padding: 10px 12px; text-align: left; position: sticky; top: 0; z-index: 1;
    white-space: nowrap; cursor: pointer; user-select: none;
  }

  thead th:hover { color: var(--text); }

  tbody tr {
    border-bottom: 1px solid rgba(42,51,80,0.5);
    transition: background 0.1s; cursor: pointer;
  }

  tbody tr:hover { background: var(--surface2); }
  tbody tr.highlighted { background: rgba(107,125,179,0.15); }

  td { padding: 9px 12px; white-space: nowrap; }

  .badge {
    display: inline-flex; align-items: center; justify-content: center;
    width: 24px; height: 24px; border-radius: 6px;
    font-size: 12px; font-weight: 700;
  }

  .badge-inline-A { background: rgba(255,59,92,0.15); color: var(--A); border: 1px solid rgba(255,59,92,0.4); }
  .badge-inline-B { background: rgba(255,170,0,0.15); color: var(--B); border: 1px solid rgba(255,170,0,0.4); }
  .badge-inline-C { background: rgba(0,214,143,0.15); color: var(--C); border: 1px solid rgba(0,214,143,0.25); }

  .ic-bar { display: flex; align-items: center; gap: 6px; }
  .ic-track { width: 60px; height: 5px; background: var(--border); border-radius: 3px; overflow: hidden; }
  .ic-fill { height: 100%; border-radius: 3px; }

  .sector-pill {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 10px; padding: 2px 8px; font-size: 10px; color: var(--text-dim); white-space: nowrap;
  }

  .tag-mono { font-size: 11px; letter-spacing: 0.3px; color: #8fa8d0; }
  .prod-si { color: var(--C); font-size: 10px; font-weight: 600; }
  .prod-no { color: var(--text-dim); font-size: 10px; }
  .prod-sino { color: var(--B); font-size: 10px; font-weight: 600; }

  thead th.sort-asc::after { content: ' ↑'; }
  thead th.sort-desc::after { content: ' ↓'; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .stats { animation: fadeUp 0.4s ease both; }
  .filters { animation: fadeUp 0.45s ease both; }
  .chart-card, .side-panel { animation: fadeUp 0.5s ease both; }
  .table-card { animation: fadeUp 0.55s ease 0.1s both; }

  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: var(--surface); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  /* Sync button */
  .sync-btn {
    display: flex; align-items: center; gap: 8px;
    background: var(--surface); border: 1px solid #3b7cff;
    color: #3b7cff; padding: 8px 16px; border-radius: 20px;
    cursor: pointer; font-size: 12px; font-family: 'DM Sans', sans-serif;
    font-weight: 600; letter-spacing: 0.5px; transition: all 0.2s;
    white-space: nowrap; flex-shrink: 0;
  }
  .sync-btn:hover { background: rgba(59,124,255,0.15); box-shadow: 0 0 16px rgba(59,124,255,0.3); }
  .sync-btn:disabled { opacity: 0.5; cursor: not-allowed; }
  .sync-btn .spin { display: inline-block; animation: spin 0.8s linear infinite; }
  @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

  /* Config panel */
  .config-panel {
    background: var(--surface); border: 1px solid #3b7cff;
    border-radius: 12px; padding: 16px 20px; margin-bottom: 16px;
    display: none; animation: fadeUp 0.2s ease both;
  }
  .config-panel.open { display: block; }
  .config-label { font-size: 11px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; }
  .config-input {
    width: 100%; background: var(--surface2); border: 1px solid var(--border);
    color: var(--text); padding: 8px 12px; border-radius: 8px;
    font-size: 12px; font-family: 'DM Sans', sans-serif; outline: none;
    transition: border-color 0.15s;
  }
  .config-input:focus { border-color: #3b7cff; }
  .config-hint { font-size: 10px; color: var(--text-dim); margin-top: 5px; line-height: 1.5; }

  /* Toast */
  #toast {
    position: fixed; bottom: 28px; left: 50%; transform: translateX(-50%) translateY(80px);
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 10px; padding: 10px 20px; font-size: 13px;
    z-index: 9999; transition: transform 0.3s ease, opacity 0.3s ease;
    opacity: 0; pointer-events: none; white-space: nowrap;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  }
  #toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
  #toast.ok { border-color: var(--C); color: var(--C); }
  #toast.err { border-color: var(--A); color: var(--A); }
  #toast.info { border-color: #3b7cff; color: #3b7cff; }
</style>
</head>
<body>

<div class="wrapper">
  <header>
    <div class="logo-block" style="background:none;padding:0;overflow:hidden"><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/2wBDAQMEBAUEBQkFBQkUDQsNFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBT/wgARCADIAMgDASIAAhEBAxEB/8QAHQABAAICAwEBAAAAAAAAAAAAAAcIBQYCBAkDAf/EABsBAQADAQEBAQAAAAAAAAAAAAAEBQYDBwEC/9oADAMBAAIQAxAAAAG1ID81I25qI25qI25qI25qI25qI25qI25qI25qI25qI25x5AAHW8zPTPzmiSNrTM853MMpmEMpmEMpmEMpmEMpmEMpmEMpmEMx5amud7T+heSxuS2mWAA63nN6M+c0GXZFldn8v9A0Nt30/f501ufw+NTdzMR++tstz+fcM2/oduWvsltZoTL5n590+udjK53VV6F5LG5L0bDgAdbzm9GfOaDLuxHOx5nz/Z/PrdzrSeGwdbEfeVH+2Twv58+vrw/eXTcNVx/dk8O3HuW2SqsNHmPT8F35flVbf1Anw/QvJY3JbfJgD8Ov5zei3nRBl2ScXkHpnJxHJxHJxHJxHJxHJxHJxHKudiq66eg9C8licp6Nh+QFc7GRAUZ6U5RH+fvQSsgSYpSsIpSsIpSsIpSsIpSsIpSsIpSsIp+MuR3259K2MYT/AC+MygA63nz6DefMTtcoeb6hgM/C8rloX7CjcZ/0I+Wr4nEX8SIVbigmpCsg8v3t+8Q7HPH9+hnOC50yF0p7cKntrEvrksbktrQgAdbz59BvPmJ2uUPN9Qqtaii1/XdPGSrremqZv1rH6XUzdX6UoatbwtQtfVDvfn7eWhvZ+fL9zBamL5Qydyp7cKnsvjfXJY3JbWhAA63nz6DefMTtcoeb6jA0QtfU7Z0dk8FK2IrZVedW+LXUtnY7sTEGVuK+TlBtqriDk9x2Fi70I3VT24VPb6vvrksbktrQgAdbz59BvM6P0vqqux15IEV5RbQrNdSuCsl4vtdpcwbTxxD6om4ud4cTo9qFV1ZLtQquLUU9zUa2kP0lyWNyWlqwAGCztLi3PCNcQTB9a4zCbD3KeycTcrXKpv8A+Vy+pYz5VplwkLqdulxdL4xzARcL4Y+qZd/9+P2AAPyq9qMYVJ3OwHyKs7JZL4lNJXnP6lYZj3DiV37NgPwjuKbO8zrVstb0yE9AtRkStvRsD0jbOX5+gAAAAAAAAAAAAAH/xAArEAABAgQDCQEBAAMAAAAAAAAFAwQAAQIGBxQXEBESFRYgNDU2E0AiIzH/2gAIAQEAAQUC/rnPdLq8HHV4OOrwcdXg46vBx1eDjq8HHV4OOrwcdXg46vBx1eDjq8HHV4OOrwcdXg46vBx1eDjq8HFNUq6exz44kfzUhp9VGn1UafVRp9VGn1UafVRp9VGn1UafVRp9VGn1UafVRp9VGn1UafVRp9VGn1UGBvKXwz13Y58e0Pof4by9+M9d2OfHtD6H+G8vfjPXdjnx7Q+hHDlSS1QNgnU1B0uCTgSxRTZg0FhxAFlmrRtN25Mh+V1DGPMHhUfy10xAZscHGSKKoMVHTyoCybTJMqWK7K35ux0Xl78Z67sc+PaH0IH/AFhZz3ztLz3jQbTSxQTc20WnSHFWs0nvcM3DoFatG5wTpqKDUFJIvLZo/J/bUpZheqqtZujNyvUkug8ONMmRvL34z13Y58e0PoQpblqtbQMrWKeMWJNygJnQo/QnbqBZB0KVKptQ4U5Um4ZPGrRpb5RBqgxJ0c+YEGzYqPJ1Dny6Qh/WyVGNCi5p3W4OPm5BveXvxnruxz49ofQ/w3l78Z67bOcpQ5rpy9ofQ8Uo4pRxSjilHFKOKUcUo4pRxSjilHFKOKUcUo4pRxSjilHFKLy98Nrp5dKcp7caVlERWfcxTVOieZVjMqxmVYzKsZlWMyrGZVjMqxmVYzKsZlWMyrGZVjMqxmVYzKsZlWKqp1zzzmUYKLqLMtmI9qPLrY14OnaKBAtY0Q0vLxpeXjS8vGl5eNLy8aXl40vLxpeXjS8vGl5eNLy8aXl40vLxpeXjS8vGl5eNLy8GBCwN+jg+cXRw2tF7abba58fD367aeJ8nE6qk4lisS3oKyXReOaWbTVUnGqpONVScaqk4TxXfymIxOZPlKapV07MRvqxnruxz4+Hv123FJ9+AXZZrvO2ziE+ydtbQNlvLhaF7DKCG8YYHK3bbZiN9WM9d2OfHw9+u24ovv3OBx8ypNZOaKuFjv9Q2K77eqKZTIknCM268YYU7reNPm48ZP/uFlE5ntmI31Yz13Y58fD367bcj3mJ3DNnmLhvVlkbmwqd/mTvl9n7mw1Y5q4rtbZW5IRfOG9KzpZzCSVa6lh2zUAYbMRvqxnruxz4+Hv12w88yAec+KeE7Pc1xWZcD+1Ckg5pZSayuFbH8xuJjb8bjixbSYHhssNgspjbfHiOzEb6sZ67sc+Ph79dsxOe5a34sFnk7XxLZZm3tlpseXW9iw2/zjC6W4F24jfVjPXdjnx8Pfrtl+22TuFzpqbhi2kzZGWPMhWmpuGuGpbMylulfIBwfGaam4scK6BCu3Eb6sZ67sc+OGKqhCOqZONUycapk41TJxqmTjVMnGqZONUycapk41TJxqmTjVMnGqZONUycapk41TJxqmTg0XVOkBnru2Y8ZTXMUwpkmNHK0qDhqMuUsIywjfylhOFR4xCSQ8YvSqPGIUpMBjiVYwclSixFuImJYSlS1E1z5Qxjlw2aig8ajLLiJxKUpS7b3IOJX1iKc/K08H1a6Q2JSri5D9gmueWvbAIVcCuFZhxTb1tglsTHIyzWVlLW0CWxKWum11MP6L9NyMrWtZwUa8L+qB2+Nd2Zh0aXXstgVeNz1x2uzuxsTtJo4u9FP8kuyc90rXGyudOzF17ruKzH9AS5bWt83cyuHNS1s3Ta9lo3WPsArQWB2JclFkrdSh7slYVzI2hTft2oXM1dciBBbBkmhiAfnOkJhrZIg+CxNe0BbbK4dnG9sU4hZTDjD41b9uDaapVU9k5b5MBbQXQzEMR6sgY+ThozQYIctaTeshjMbCTFuguQDMS1I8IwEwQCsC0h4QeJgiHYlqR4pmJTUTpWTZD2o1J2MaPlKqZV0zt0XNr0gDiUt0v6//8QANBEAAQMBAwgJBQADAAAAAAAAAQACAwQREhMUFSAhMVFScQUQIjM0YYGhsSMkMEHRMlDB/9oACAEDAQE/AfzU7BJMxjthIWaqPg9ys1UfB7lZqo+D3KzVR8HuVmqj4PcrNVHwe5WaqPg9ys1UfB7ldKUMFNCHxNsNuhSeIj5j5UtXFE647b5a1lsN67/w/tCtgL8O3XbZ6p08bZBET2isdmLg29rasrhsebf8dqlq4oiGuOtOqomRiVx1FdNeGHP+6FJ4iPmPlBxpZ5C9pId+wLfREuyov7QBs2D5QhlDzIQS2+dXwVLFUSOdUtGw6t+r+qUSYr6pjTaCLOVmv5Rp5I45I7NrQfW1WmlqHSOaSHAbNexVDJa2QBosAH781Xue7o9mINdv90KTxEfMfP4emvDDn/dAAk2BYM+4rBn3FYM+4rBn3FYM+4rBn3FYM+4rBn3FPjkaLXjQh7xvPqmdcjLllMvEjJ9O/wCSymXiTZp3mxpWUTxHtKKQSsDgq7uvXQh7xvPqrnWR3d6Mf0g/zTpPtQEY/pB6glwX3lPPjkalSsLIgCq7uvXQh7xvPqrnWvDdydH9rYrxsuqWO7SgKkaHyWOTYmN1gdVd3XroRm68ErLYk91NI68SVlcNli+180+qhe26VG+midebastiWWxKqqGSsut/1X//xAA2EQABAwIBCAkDAwUAAAAAAAABAgMEABEFEhMUFTRSsdEgITFBUWFxcqEQIoEGJTAyQlCRwf/aAAgBAgEBPwH+aUtTUdxae0A8K13P3/gcq13P3/gcq13P3/gcq13P3/gcq13P3/gcq13P3/gcq13P3/gcq13P3/gcqwfEZMuQUPKuLeA8uhO2R32nhTMF99GcSOrzIHGhh7+Tl2FuvvHdRw6QG87bqtftHZ42pMZ1bRfA+0Vo7mZz9vtvatBfJbTk/wBfZTMJ58FSR1DvJtSIb7jqmUj7hX6e2s+08R0J2yO+08KUkTYzSW1gFHUQTb80AnQkt/YSCrtPCjIZKA0kgLzYGVxTTL0RtKIaj2jrPVa6uVMlrMohrWLKCr+t+rhSZTTrrTuUAEqI/FuqiEzIqGkKAUknqJte/fUVxnDmyVquon+09w51hqW04m5mjdJF/wDduhO2R32nh/D+ntrPt5dBRCQSrsrTIm8K0yJvCtMibwrTIm8K0yJvCtMibwrTIm8K0yJvCmn2HTZsgnoS9nc9Dw+kVrPPJRWr4u5SWLyMz52rV8XcpyJCaTlLSAK0GFJTdv4qQwY7pbPdWDbQfTl0Jezueh4fTBm8p8r8BQfvJLPlem4/7kpX5oP3klnyqZGMprNg2qDD0JJub3rEXkvSCpPZWDbQfTl0Jezueh4fTBm8lkr8TSJH7lledv8AlBACyvvqK/l4iVeN6xNxTUfKQbGlyXnBZayfpg20H05dB9BcaWhPeDWqJXgKZbxBhAbQE2FDC5YVl99E4l4JprDZjKw4m1xUhnEJKM2sC1aoleArVErwFYdBejPZbnZb/Ff/xABEEAAABQEBBxEFCAMBAQAAAAAAAQIDBBESBRMhMTOS0RAUICIyNDVBUXFykZOUsbLhI2FzgYIGJEBCUqHB8ENi8WOD/9oACAEBAAY/AvxdTwEOGIPeE6RwxB7wnSOGIPeE6RwxB7wnSOGIPeE6RwxB7wnSOGIPeE6RwxB7wnSOGIPeE6RwxB7wnSOGIPeE6RwxB7wnSOGIPeE6RwxB7wnSOGIPeE6RwxB7wnSOGIPeE6RwxB7wnSOGIPeE6QSknVJ4SMti70TDcUl3u3XbUrxVG/S7P1G/S7P1G/S7P1G/S7P1G/S7P1G/S7P1G/S7P1G/S7P1G/S7P1G/S7P1G/S7P1G/S7P1G/S7P1G/S7P1G/S7P1G/S7P1G/S7P1C4xuXyyRbalBF+Enw2LvRMRfq8p/gnuinwEX4SfDYu9ExF+ryn+Ce6KfARfhJ8Ni70TEX6vKYvbfFjUfEL2ufR0Oxb/UkJtW0kFmmeSlp/LQIlvSbyk/d7xrlh4n2eUNspxqOgbou+IVx0CWbVkj4xerVoqVIwuSazSdDsppjC0Gs0WU1wENbtYTrQEiROsu8hAkIeJ5JlWpBUi3ZVhsppj1HuinwEX4SfDYu9ExF+rymJi28ph8NR34f8kHVIlqU7h2tOMNNuO3lKjPbfUEwkWl3z85h6VZrZKiecLKQmj7Zmsg+8eJCBCkFtnK3tXOG4CdyhnDziWn9JU/cT1lu+L9wtS8KjPCENpxqOghttN/dm00UYcSW5Vtkh7op8BF+Enw2LvRMRfq8phRLK0yvdEL6Uk20n+QSFpWaWDTRJqDi0SFm5jIveERiX7Yj3PzC482ttG4VxmGWIjpk7+YywGFFLeUpo0/nwi6KUOYV1JsjLiC2pKqFatJCpLqrLaq4T5BMcNz2a9ydAp1O2QrdFykL9rg2DPCpNBfEOKvaUYDUX5gtaX1pTXAkjEZaVe3ItsQe6KfARfhJ8Ni70TEX6vKf4J7op8BF+Enw2GE6B3bFuTEX6vKYxjGMYxjGMYxjGMYxjGMYxjGMYxjGHuinwEXbFk0+AwHXVueba1I9qe5OnEN8O55ipHQ+UhlV5wyq84ZVecMqvOGVXnDKrzhlV5wyq84ZVecMqvOGVXnDKrzhlV5wyq84ZVecMqvOGVXnCqjMz943w7nmLqXxxS6OI3R14j1YjUM2iU0s1HfVUBqNyHQirlD0BqGwaSdcrS2eDAVRu42eegbuNnnoG7jZ56Bu42eegbuNnnoG7jZ56Bu42eegbuNnnoG7jZ56Bu42eegbuNnnoG7jZ56Bu42eegbuNnnoG7jZ56Bu42eegbuNnnoC4kg0m6kiM7B1LCEOJciWVlaKrh6BORNU0ZvKSab0quKuwd6JiD9fkVsJMuhGptNSI+MxvWJ1K0jDFi05laQhwsSkkoPPq3LaDWfyG9onUrSN6xOpWkb1idStI3rE6laRt4cZXRtF/IJuWyqEo/wA1bSQSknUj4y1ZPRR5RF+Enw2LvRMQfr8itgzHLG+5+xf0tWAvjJuwfywfwH0ke2eMm9gchhxpKCVZ25hT6kJeaTujaOtNR657yrSmNu2Z/p5P7y6snoo8oi/CT4bF3omIP1+RWwZjke1Ya/c/6QjxS/yKoFoPGk6B9iuFp2vyMQ4hHiI3DEaMX+Vwkhxo8aFGnUUfK6YfdkqJLdg8B8fu1H1FiJg69Zasnoo8oi/CT4bF3omIP1+RWwmv8SnDpzC+UwMtmr+BORSiVLvhfPCJUeuUbqRcwmHWqWzvRfL1qCdMtqwg1fPELoI/9TV14dSy0+42nkSsyHtXVudNVQlttJrWrASU8YW4+VJT9DUX6S4i1ZPRR5RF+Enw2LvRMQfr8itWY/8AobMVPGJ0r9SybL5Yf5IRJRFu0WD+X/Q1JVuCJVeoLcUdVKO0YkyjLC6uyXMQt8TjZHqPPSkrNaXLJWVUGTdP/wCg+6RW2lfrpVXXsJPRR5RF+Enw2LvRMQfr8itVLJbp9wk/IsOpEqVFOVcP5nooL6RYWVkrVgtUoq9kpXOeEQH+UlI1HT5XT2Unoo8oi/CT4bF3omIP1+RWrF1ohBstJPdLptj/AOEMm12hBhgsTaCSJUbjcbMi5xk2u0INX5DRM2itnfOLjFA03FJJvIcrtjpgGTa7QgtiUSUuG5a2p12Unoo8oi/CT4bF3omGpjJJU43WhKxYSoMhH6jGQj9RjIR+oxkI/UYyEfqMZCP1GMhH6jGQj9RjIR+oxkI/UYyEfqMZCP1GMhH6jGQj9RjIR+oxkI/UYyEfqMLlvJSlxREVE4sAi/CT4bIkHGiEs8SbCaipw4xFym2kWkRYqy5UtpMVXFioL/ZtJDecfsiFL1Cr0UjecfsiFXI0RsuVSEkKtxojhcqUJMVcjRGy5VISQq1HiOF/ohJg1LixkJLjNtI9lHiOdBCTGGHH7JIolmEZ8hJSN5R+yIXvW0W3+mwmo9pGio6SEkMlCzUChYtlInsGdi5qmrXuwhCIx+2ukaWmqch4/wBvET4juUjSTSfV/wBDVxoat5sqkOU/VTR4iI8o6vNlenOkQu89dKYuLeXPZrJyzStrrxC6ipTi3okNVWlq5KGZl/eUSrq3XkulDJw0NMNqoXMJV048qTrZthRqjrVUsGESLrXZkO60tmhqM2qhBq7NwpLrbbayJ1hxVpI+zxyXHY1x5SCcdvfPhCLpXJkuONmg02SdtI5xL+ErwEu6UicuLPaNVijvJiwBMues1Xm37RfGkhF+1Lqj1rLmLZMv9f7XqDLcpbqUIO2k2VUDVxbiuyF3vfD7i62f+BCKmqyVKnx7Go+2TisOuVG2k+apl/AuNFkJO9XIaNSiPlI/+dQ+1zbp0bb9v1GekTbuxLoJgKkuKRVSampP98BdP7Py1ko1+0QfEZ+peAu6ojNM1l72Kq4OPAYl/ZyS0mJNYQpo0kmlSxV5xLuHdmsWy6a0OKLB/cAl3IiSydddYUVUlgxUEm4d2vuTjbhqQtZbUwi4dxfvz8hZWlILARC51xLtraURtU9oWDn9wks3FecduOSFWqntfd+4nmWO8L8BrudHU86TpllDIhHuRBQTS5ir0htHEjj/AIBtruk27FjJvpRSTiMR5STtTz+6l7llx9WEKelXRQq6UnbvKOuD3AjLEeyWmJGbjJWdpRNppUw47FhsR3HN2tpskmrnEh/WTF+kFR1dgqrL3hLMZpDDKcSEFQiGvNbNa6pZv1nbU5w5rSKzGvh1XekEm0fvDr7bDaHncK3CThVzgimRGZJFivqCOgPWcNmNXHe0EQIpkNmTTFfUEdAes4TEauM20EQJM2IzKIsV9QR0Btw4rUZB4yaTSoUhaSWhRUNJ4jF6iR2ozda2GkEkg0uRGaeW0dUKWmpp5gaVFVJ4DIFGO50U45KtXo2is15aDgeD3dOgULAX4z//xAAoEAEAAgAEBAcBAQEAAAAAAAABABEhMVHwIEFhkRBxgaGxwfHRQOH/2gAIAQEAAT8h/wBYMgGKvL/J+/fv379+/fv379+/fv379+PAWwsTh3rSOEvOYFLJ6f4nnnnnnnnnnnnnnnnnlMGimJZeU2jRw71p/jn3XTNo0cO9af45910zaNHDvWnhPgsAXlBKLchKKuPI5mV4mHvBMA1Ri6RmCUc4Uj6lBzKBSTC4xTQ5sxpBcdKdJdSIqS6qO9lZJVxBFqFsBDtuNsuIArdnkDmwgLZgYSvBjy/OPl0rlhEppzm66ZtGjh3rTwnt0NJnhgiIra82Y/PwMQLGQ6IKYFcvG1QC8VZYZ2zOBY9YQ7YjFS7+2AA1e/KAHbgtUfssvVgnWV7ITlB7LhVFVTrMSY4iMlJnDHD2r3lPq7U/9ubrpm0aOHetPCeyDDjy6xliYSP8laJON5lxzbFBg9kwnAWjrY3SDAL0PUiek3hBzYk9WKaMKCXwW0a+YUgReXjMsmdCmHwQpgbiscYAdhOqRL6ylMtIrq9XaOjjUaCXkq1GQmV+c3XTNo0cO9af45910zaNHBkp5me6i6RVZhN0XedF3nRd50XedF3nRd50XedF3nRd50XedF3nRd50XedF3nRd50XedF3iGrH+Oe+C6Jkp5HxVDt69sGkVN93gVxcymfqJ+on6ifqJ+on6ifqJ+on6ifqJ+on6ifqJ+on6ifqJ+onVpStgQAA5H9I2p0b6eZ4352kNJWFDLVBKp8UFTRiFb5H+L79+/fv379+/fv379+/frRJDKFnIlSycR0lzbk/o0A3Ya8G9aT2HBqN5NPyDwz0XUqlQ2zCaJc+N9RfDXz58+BI2c0wrhmf9WhO0OAaxME8di0TaNHDvWk9hwawXOnq/Pivdv102WDAA8lt+OB72KMN+hBRXeCmqZ14LoAZhdp9DXi2LRNo0cO9aT2HBsYQFmj2+0sFTjTlBLp7Hoy37UhoP9GZPhHzwPuWDYnXIXF7XMw3HmNeDci+nDUwLc9ZNYhSFGkDjPnn4+xaJtGjh3rSew8dlMcbC8rA9iY3t66cHzKN7ASfJT0lqYPMi/jKX+hthjiWnRYPlmFtCHZ18MS3XWPaMC+ZWfKOz6ktUCn0YP9G/HYtE2jRw71pPYeOB1pWedYR1S02sswzN5LQyTHfqrPl2i+0N5b4d6lvg0eatzm6G6H9ZYErzemD4ZGahqohJeicHxMbyQ/IMeDYtE2jRw71pPYeOtFVM9R8HfwoXqHZEM3Hp1wfnxtXAFzzXzXpKqvMOz4GNna7HFsWibRo4d60nsPHE9jyDsxw8oFhZkiRoX6FSiQbSywYe9eBy8vUBS/0gECgwCE1USlgbx7eBytwAp1xbFom0aOHetJqHQlYvmbC+5sL7mwvubC+5sL7mwvubC+5sL7mwvubC+5sL7mwvubC+5sL7mwvubC+5sL7j3lA8iptGjhQSnEmc2AJelR+ZYoQe06OZB8QwrNDYPaDFjm3lKulKxYEEcef/ABnSeLvcnSWLPYnSWLvcjQK5/DEzisGB61AVDM2i7ERIwzX+EGsWSbNq/UFA5xfjKh5HcBtO5B1CsCQACgMuLKgNuGAfL7zHLAljXa+HojRNWLdWPshmVerRT5An1oQ8n3KfWYxAzcRZp6EeIBm1AJfIimRZY500ATqzlaAVVn25yuIZQvl5FnVilOOIL7jkjrLTpbyWnb/2EGq3dflXzMG3xS7IFAvBTnb6QCOxZj1/t6Q6zGrRQO1Impz8LbKxsYj4xVPnaoMnu9JkbHn6GbwkyyC4BWPPktPe3pNfe8KgvrWCuttfIufGNfdIsheTheEYdsrgMuzzIwWHBjz0daguT9lrwdC465wNxQy90OOjRGYhq64HEHpcdJTEoc8dMLGJs3eqzefnWPKph35Y9jO2eJwYsyq80r+NOdXFIoUPrmCgPtwqsBIfbIdUV7lHqyyu3xQW01nizPpXTGfs9UWNdAnTevV6xErCx4QQSxzGU7r2OohNRw4BeIMcYeLA9lVYuZgdpe1CvtY4BG5JXacLlzT5QJYUMYxBQUOFFuc+qPgV5QvV46+aQkXzl8izHE5jXzSfS5EK8otLLBu61nHjQFsHMSa7LEdaJTmZ9OqcofgtjJJR0JT9Eq+vh+AgAwA5f7P/2gAMAwEAAgADAAAAEPMMMMMMMMMMNPPK8MMMMMMMNVPPKBSRxQiggHVPPKB1tWfCJ1PFPOJAQQQQQQQUHPOFQAAAAAAAAePPPgxjo7CFqwFPPPgyNwgukCgFPPPgxFrdLkQwFPPPjPTTXnjDD1PPGOMHDACDBKHPPCOEPDGAFOANPPPPPPPPPPPPPPP/xAAoEQEAAgACCwADAQEAAAAAAAABABEhMSBBUWFxgZGhsdHwEDDB8VD/2gAIAQMBAT8Q/cVFgPBQZ9PZPp7J9PZPp7J9PZPp7J9PZPp7JZQAZrhTtXZoff2JbxaWgUG1oaiYKqg4JhkvDDnMUpZiGqarqr5zAfChwiOwMG7xEsrdYHB/vKJgUXQK1toGiVaWAade6rnafGg+/sRuoiIyFWrErVLHDK4l7TA1V484MYs1xzwcLQvLLvAm4KEcNzDdZa1y2EKKbbAHPFwhqatUON1nHHpCkohDRFUhiXnLUa5UxKatYdGWABA3uBfPPQ+/sSyWSyWSyWSyWRnI+NAQzHL9JERERFZgG/Q7N5/FNZh31TeoBz3ab1LpVjSvkk1gUyODw6HZvP4ptp4+JRtqO3+zfxa6Y+pRtKnb/YFkvCNWoH9mai4zI4PDodm8/jdo8zB64X/YodQV616m2Ap65+YNCymJ0x4fjI4PDoDkYR6M3r0jS8YvjtVWUAt385RM7Tul4Lb5vXpN69INVu7y4/8AK//EACgRAQABAwEHBAMBAAAAAAAAAAERACExUSBBYXGBofAQkbHRMOHxUP/aAAgBAgEBPxD8zhwkPESfhKKKKKKKKjqjYgvI3BrseV1VEETgQF0JE9KW2ARcr5RLeOFBYWC1GXEmOlTG1BeL3odGzc45xnrRlQJvLnvbrQ1BoQCdJUl5VKDFUEwcZjvssPK6qGACAyZhNmd++o5ZUsxezcTMSSaUvUElJi5eBYzntTM74DhG/GADuqP4gpIIVLygc6VQDChEcuVi+JqRGKABSBbMY1qGteBhRuu5e4VGwiI3CUdJjY8rqqGoahqGoahqGoaD1XzsFqgEvLf+F3d3d3s3ibabHgtXoC5IpPLL2rge/wB0heaYa4Hv91xlwzQ6JzTbpMe5V7fVqbmu6/Ow8Fq9JYx3m3xNHo56pv2SoIlg9yB8rRFbi9Z+orfKBmJxQhlZOAimdkQTrH7ruvzsPBavSd89o/c1czsroiHcKGOQHQn7q41ojkY+KWokLlQaGisendfnYZqAHNEr+hXhVDrQEBBnO/NLE8PeiJkSS1kKps6da/oV/Qp8BJFmbyfX+V//xAApEAEAAgECBAYDAQEBAAAAAAABABEhMVFBgfDxIGFxkaHBEECxMNHh/9oACAEBAAE/EP2z8ipUA1V/URIkSJEiRIkSJEiRIkSJEiRAfyESLETUTj4en74egmVW/hd468Z3/Pf89/z3/Pf89/z3/Pf89/z3/Pf89/z3/Pf89/z3/Pf84qiu6dMnS618Qbp++fD/AGIADdP3z4f7EABun758ORiO7M1W+exKPXocei/uVyKBF02Fw8eXSOcark/VvL0cKaY5vj/UHEBxIurwol+lRtENEv8A5BbEdRIJjrgvCFchOgF6etQyp3fB1x5JADyVF6rbxaVKraAGrqspFN6ZRSO0QosYULbNvvUPPPCIdCil8cMYpgpQmFbstHhtGYKDSPB8YAN0/fPhyM+xd6Cj5XnETOtS1d41S26zJ1lL1sOqt5QcIIGGpTVxrM3AgirgbOlG0Uhb28Whyo5xg/6yyPTyCvImRwPc2/EOOFTJUov1S+cTIGDcHyK85bpV+cj6hLDQaZE2PVD2ItEEc5Nw7nyBW1AddWLCli3oMZ2YbWdo9AOXjABun758ORB0DIKNCeiicT0jKwzgLmi7HzDASQk2DFtY4xwcvLFoeW4cZKJVkN1WjcoBr8x0eQ3qQvVB3Vm/Na10CHDUCpcAzqWSjiZBhcNc20tGOmA7UYRBiAK89VytB/6Mr5tSDQuKs46zhIF2ywmyanPeG5VRRa1QppfK4CIagCWIa/jVg6/srmANqlf3RvUFcSD5fGADdP3z4f68ABjRAdECP9t++AxArNY9rTtadrTtadrTtadrTtadrTtadrTtadrTtadrTtadrRXQNQbgckXbyNUI1oa/I63UAaSouIBQcI5Y0QfIDhhJ0r9zpX7nSv3OlfudK/c6V+50r9zpX7nSv3OlfudK/c6V+50r9zpX7nSv3OlfudK/cZMerk5sLv1AYG0EyQaAbas1+V757QotabPKOsWAGgtrlgtlaR4cCmWsa1+lu3bt27du3bt27du3bt25rWoKRqVNE4QIUMAACzjpjZusZoQTYrXwdP3+Fpekm1uoNSNK8E/E0l5sUG1xrfBnacRAE95QnXC1YtOdVG9qrwWbNmkm15Eler/GNsgcVWMPMabsBz68IyI8T/HaG6fv8LTASB3iu+73fla/pnXVHmgec0MP7nQPKnPwKbW1KBXJjMS/i6C1SFHFr8KVyS9QWz08qcP8dobp+/wtOdGfT4sLGL2SlX4jfNZoKD/JlWlWoKHpb5zI8F3RWfkQDiuuoU5VnKcTM8rLXyfhUoqBtQJQMhgWYA6m6olziVLXRtH4O2hQDn9P+O0N0/f4GigVaDKsUJX04LXyCWJmWzBQnrcYeiqKLbXkRGEY+8zH3JgSfNdBr6NZwKJmh/jGoNMDXG/u/wAZeayTdWkFzDIVUfpZgyRoXNADWIePBqVy72lOKHA/x2hun7/A0HqwV40U87SJMSRxXKwL3aj0KXq0mLwWnF2+aQEFu9xSHMBzj9tfssl5rDKwizOUnp/CJnVrzH8D8Ly22pbJTm1hVEbvW9aDC7LKFg4menldf5bQ3T9/gaaIIRzQv6WP4NTBVXFL9nsjJQ+drm9vyyPbQoYJ8ySjyWINUcvv+Doppb0R/ptDdP3+BogT9MD1NQyPNjiQOW6oIwUHCv6Svw3dai7wKZRtnEijHcdgMrlRCFCAFAEMM1a6Wbjej8PGDNHZAMnp/ptDdP3wQ7g65HAjo+Otfpe/fv379+/fv379+/fv37YNK4AJoVdA8QZEAhSJYkrMvl50pWYUg0SBqq4QAhqF2GpZSUXjWtShRnDiCkgsStJWGJbOs7VUInFgUSQ7k0KT6hFB21n71QgJzaFp9QJrUIInqpD51frfKhMF7QX1WQYnWAA3WWANSE9APxXIxdByVduSPM+hy2ELhxAaARX2gGmA0DgBt4nfMuDGl8khhNR/giNXDimjB07FENzIH+2Npw6HgB5oj3dFzhSl84SkylbSc3g4T04xIxLNXQAXhwfNLVoRoVmCDdhY2usdhJoNgXFtVAOXXhLRanjgpeBhZSZXWUohajhbq1Vg4InBhNmmEB3TYWNGA6TCESMW2a1CUtGVDGpFEoSVPmbBhW9Q1aH2gMwLFhRVrWbQnrQODXlgBWFx5s3QrktFMVUAAeINcaCt3Vi18fr1dQWbtW+FXaUnyIBFZ3AmPl7JDCM2FXacVsbKPCSDoD8fGv2lcyOQAMBUU3UaA4WhyNqgbyEAdAZBU0qIF6m8OvWpdESj1iDiQX1h0gUgyQjGsH310NySAqLXlMZKfhAUNVAYRYA7l8TAIOBOgLeMwAJCMqJqQFOOFShhL2pwXVKELcTLGfNA1GDgXWmOhOdX1leuCVKqHqHXyouBr0QKrjlVzmMwBZS62u9yOKI8GY91Udi1OKeAShdhuIlj4QTGQFibRI+V7wEgFoCKAi8zbBnIubyy3rqJCWLRRHCi9CakUBIVoC1WY5uEzZRZQy4GEgAQoy6orZcu7A1FL4IJdADLMutbL6gvkh238WMW82a9tPoILOTB/wCYSMW82JkqyqvML5JXCRX3KC3mwJ7ky1IYRMIxC4pqT1phbWsBLkD1EAtWGm0QKEG1FInESUg0VtKzaHGF/hEfkQKgGgH7n//Z" alt="Ceramica Marcos Paz" style="width:100%;height:100%;object-fit:cover"></div>
    <div class="title-block">
      <h1>Matriz de Criticidad de Activos</h1>
      <p>Planta Cerámica Marcos Paz &nbsp;·&nbsp; 74 equipos &nbsp;·&nbsp; IC = C1×0.50 + C2×0.30 + C3×0.20 &nbsp;·&nbsp; Rango 1.0 – 5.0</p>
    </div>
    <button class="sync-btn" id="syncBtn" onclick="syncFromSheets()" style="margin-left:auto">
      ⟳ Actualizar desde Sheets
    </button>
  </header>

  <div class="stats">    <div class="stat-card A">
      <span class="stat-badge badge-A">A</span>
      <span class="stat-num">5</span>
      <span class="stat-label">Críticos · IC ≥ 4.0</span>
    </div>
    <div class="stat-card B">
      <span class="stat-badge badge-B">B</span>
      <span class="stat-num">35</span>
      <span class="stat-label">Semi-críticos · IC 2.5–3.9</span>
    </div>
    <div class="stat-card C">
      <span class="stat-badge badge-C">C</span>
      <span class="stat-num">34</span>
      <span class="stat-label">No críticos · IC &lt; 2.5</span>
    </div>
    <div class="stat-card" style="border-color:#3a4560">
      <span class="stat-badge" style="background:#3a4560;color:#aab4cc">↑</span>
      <span class="stat-num" style="color:#fff">4.6</span>
      <span class="stat-label">IC Máximo</span>
    </div>
  </div>

  <!-- CRITERIOS -->
  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;margin-bottom:24px;animation:fadeUp 0.45s ease both">
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;border-left:3px solid var(--A)">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
        <span style="background:var(--A);color:white;font-family:'Bebas Neue',sans-serif;font-size:14px;padding:2px 8px;border-radius:4px;letter-spacing:1px">C1 · 50%</span>
        <span style="font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:1px;color:var(--A)">Impacto en Producción</span>
      </div>
      <p style="font-size:11px;color:var(--text-dim);line-height:1.55;margin-bottom:8px">Mide el lucro cesante. ¿La falla detiene la facturación?</p>
      <div style="display:flex;flex-direction:column;gap:3px">
        <div style="font-size:10px;color:var(--text-dim)"><span style="color:var(--text);font-weight:600">1 — Insignificante:</span> No afecta la producción, planta sigue normal.</div>
        <div style="font-size:10px;color:var(--text-dim)"><span style="color:var(--text);font-weight:600">2 — Menor:</span> Reduce levemente eficiencia, no para la línea.</div>
        <div style="font-size:10px;color:var(--text-dim)"><span style="color:var(--text);font-weight:600">3 — Moderado:</span> Parte de la línea se detiene, buffers &gt; 4h.</div>
        <div style="font-size:10px;color:var(--text-dim)"><span style="color:var(--text);font-weight:600">4 — Alto:</span> Parada con pulmón &lt; 1h o descarte masivo.</div>
        <div style="font-size:10px;color:var(--A);font-weight:600">5 — Crítico: Parada Total Inmediata. Sin pulmones.</div>
      </div>
    </div>
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;border-left:3px solid var(--B)">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
        <span style="background:var(--B);color:#0e1117;font-family:'Bebas Neue',sans-serif;font-size:14px;padding:2px 8px;border-radius:4px;letter-spacing:1px">C2 · 30%</span>
        <span style="font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:1px;color:var(--B)">Costo y Complejidad</span>
      </div>
      <p style="font-size:11px;color:var(--text-dim);line-height:1.55;margin-bottom:8px">Mide el impacto en caja y la dificultad técnica de reparación.</p>
      <div style="display:flex;flex-direction:column;gap:3px">
        <div style="font-size:10px;color:var(--text-dim)"><span style="color:var(--text);font-weight:600">1 — Bajo:</span> Reparación simple &lt; USD 100, repuestos genéricos.</div>
        <div style="font-size:10px;color:var(--text-dim)"><span style="color:var(--text);font-weight:600">2 — Medio-Bajo:</span> Repuestos estándar de pañol, tiempo &lt; 2h.</div>
        <div style="font-size:10px;color:var(--text-dim)"><span style="color:var(--text);font-weight:600">3 — Medio:</span> Repuesto específico (motor mediano), 4–8h de trabajo.</div>
        <div style="font-size:10px;color:var(--text-dim)"><span style="color:var(--text);font-weight:600">4 — Alto:</span> Repuesto costoso o importado, MOE especializada.</div>
        <div style="font-size:10px;color:var(--B);font-weight:600">5 — Muy Alto: Repuesto capital (reductor, PLC). Tiempos largos.</div>
      </div>
    </div>
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;border-left:3px solid var(--C)">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
        <span style="background:var(--C);color:#0e1117;font-family:'Bebas Neue',sans-serif;font-size:14px;padding:2px 8px;border-radius:4px;letter-spacing:1px">C3 · 20%</span>
        <span style="font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:1px;color:var(--C)">Frecuencia de Falla</span>
      </div>
      <p style="font-size:11px;color:var(--text-dim);line-height:1.55;margin-bottom:8px">Mide la confiabilidad histórica del activo.</p>
      <div style="display:flex;flex-direction:column;gap:3px">
        <div style="font-size:10px;color:var(--text-dim)"><span style="color:var(--text);font-weight:600">1 — Muy Baja:</span> Menos de 1 vez al año.</div>
        <div style="font-size:10px;color:var(--text-dim)"><span style="color:var(--text);font-weight:600">2 — Baja:</span> 1–2 veces al año.</div>
        <div style="font-size:10px;color:var(--text-dim)"><span style="color:var(--text);font-weight:600">3 — Media:</span> 1 vez por trimestre.</div>
        <div style="font-size:10px;color:var(--text-dim)"><span style="color:var(--text);font-weight:600">4 — Alta:</span> 1 vez al mes. Requiere ajustes constantes.</div>
        <div style="font-size:10px;color:var(--C);font-weight:600">5 — Crónica: Falla semanal o diariamente.</div>
      </div>
    </div>
  </div>

  <div class="filters" id="filters">
    <span class="filter-label">Sector:</span>
    <button class="filter-btn active" data-filter="sector" data-val="todos">Todos</button>
    <!-- sector buttons added by JS -->
    <span style="width:1px;height:20px;background:var(--border);margin:0 4px;display:inline-block"></span>
    <span class="filter-label">Clase:</span>
    <button class="filter-btn active-A" data-filter="crit" data-val="todos-crit" style="background:transparent;border-color:var(--border);color:var(--text-dim)">Todas</button>
    <button class="filter-btn" data-filter="crit" data-val="A">Clase A</button>
    <button class="filter-btn" data-filter="crit" data-val="B">Clase B</button>
    <button class="filter-btn" data-filter="crit" data-val="C">Clase C</button>
  </div>

  <div class="main-grid">
    <!-- BUBBLE CHART -->
    <div class="chart-card">
      <div class="card-title">Gráfico de Burbujas — C1 (Producción) × C2 (Costo/Complejidad) · Tamaño = C3 (Frecuencia de Falla)</div>
      <div class="chart-wrap">
        <canvas id="bubbleChart"></canvas>
      </div>
      <div class="heat-legend">
        <div class="heat-item"><div class="heat-dot" style="background:var(--A)"></div>Clase A — Crítico (IC ≥ 4.0)</div>
        <div class="heat-item"><div class="heat-dot" style="background:var(--B)"></div>Clase B — Semi-crítico (IC 2.5–3.9)</div>
        <div class="heat-item"><div class="heat-dot" style="background:var(--C)"></div>Clase C — No crítico (IC &lt; 2.5)</div>
        <div class="heat-item" style="margin-left:auto;font-style:italic">Burbuja más grande = mayor frecuencia de falla</div>
      </div>
    </div>

    <!-- SIDE PANEL -->
    <div class="side-panel">
      <!-- Heat matrix -->
      <div class="heatmap-card">
        <div class="card-title" style="font-size:15px">Matriz de Calor C1 × C2</div>
        <div id="heatmap"></div>
        <div style="display:flex;justify-content:space-between;margin-top:6px;font-size:9px;color:var(--text-dim)">
          <span>← C1 · Impacto Producción (1–5) →</span>
          <span>C2 ↕ Costo</span>
        </div>
      </div>

      <!-- Donut sector -->
      <div class="chart-card" style="padding:20px">
        <div class="card-title" style="font-size:15px">Distribución por Sector</div>
        <canvas id="sectorChart" style="max-height:190px"></canvas>
      </div>
    </div>
  </div>

  <!-- ESTRATEGIA DE MANTENIMIENTO -->
  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px;margin-bottom:24px;animation:fadeUp 0.5s ease 0.05s both">
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:18px;border-left:4px solid var(--A);box-shadow:0 0 20px var(--A-glow)">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
        <span style="background:var(--A);color:white;font-family:'Bebas Neue',sans-serif;font-size:22px;width:34px;height:34px;border-radius:6px;display:flex;align-items:center;justify-content:center">A</span>
        <div>
          <div style="font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1px;color:var(--A)">Críticos — No pueden parar</div>
          <div style="font-size:10px;color:var(--text-dim);letter-spacing:0.5px">IC 4.0 – 5.0 &nbsp;·&nbsp; 5 equipos</div>
        </div>
      </div>
      <p style="font-size:11px;color:var(--text-dim);line-height:1.55;margin-bottom:10px">Su falla genera parada total inmediata o daños graves irreversibles. Sin pulmones disponibles. Alto costo de reparación.</p>
      <div style="background:rgba(255,59,92,0.08);border:1px solid rgba(255,59,92,0.25);border-radius:8px;padding:10px">
        <div style="font-size:10px;font-weight:600;color:var(--A);letter-spacing:1px;text-transform:uppercase;margin-bottom:6px">Estrategia</div>
        <div style="font-size:11px;color:var(--text);line-height:1.6">
          ✦ <strong>Mantenimiento Predictivo</strong> — monitoreo continuo de condición<br>
          ✦ <strong>Mantenimiento Preventivo</strong> — planes estrictos de intervención<br>
          ✦ <strong>Stock de repuestos críticos</strong> en planta para respuesta inmediata
        </div>
      </div>
    </div>
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:18px;border-left:4px solid var(--B);box-shadow:0 0 20px var(--B-glow)">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
        <span style="background:var(--B);color:#0e1117;font-family:'Bebas Neue',sans-serif;font-size:22px;width:34px;height:34px;border-radius:6px;display:flex;align-items:center;justify-content:center">B</span>
        <div>
          <div style="font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1px;color:var(--B)">Semi-Críticos — Con Cintura</div>
          <div style="font-size:10px;color:var(--text-dim);letter-spacing:0.5px">IC 2.5 – 3.9 &nbsp;·&nbsp; 35 equipos</div>
        </div>
      </div>
      <p style="font-size:11px;color:var(--text-dim);line-height:1.55;margin-bottom:10px">Afectan la producción pero permiten un margen de maniobra gracias a pulmones o buffers. Pueden ser redundantes o de bajo costo de reparación.</p>
      <div style="background:rgba(255,170,0,0.08);border:1px solid rgba(255,170,0,0.25);border-radius:8px;padding:10px">
        <div style="font-size:10px;font-weight:600;color:var(--B);letter-spacing:1px;text-transform:uppercase;margin-bottom:6px">Estrategia</div>
        <div style="font-size:11px;color:var(--text);line-height:1.6">
          ✦ <strong>Mantenimiento Preventivo</strong> — intervenciones programadas<br>
          ✦ <strong>Inspección Sensitiva</strong> — rondas y chequeos regulares<br>
          ✦ Repuestos disponibles en plaza (no necesariamente en almacén propio)
        </div>
      </div>
    </div>
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:18px;border-left:4px solid var(--C);box-shadow:0 0 20px var(--C-glow)">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
        <span style="background:var(--C);color:#0e1117;font-family:'Bebas Neue',sans-serif;font-size:22px;width:34px;height:34px;border-radius:6px;display:flex;align-items:center;justify-content:center">C</span>
        <div>
          <div style="font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1px;color:var(--C)">No Críticos — Auxiliares</div>
          <div style="font-size:10px;color:var(--text-dim);letter-spacing:0.5px">IC 1.0 – 2.4 &nbsp;·&nbsp; 34 equipos</div>
        </div>
      </div>
      <p style="font-size:11px;color:var(--text-dim);line-height:1.55;margin-bottom:10px">Su falla no detiene la producción ni compromete la seguridad. Son prescindibles y transparentes al proceso productivo principal.</p>
      <div style="background:rgba(0,214,143,0.07);border:1px solid rgba(0,214,143,0.2);border-radius:8px;padding:10px">
        <div style="font-size:10px;font-weight:600;color:var(--C);letter-spacing:1px;text-transform:uppercase;margin-bottom:6px">Estrategia</div>
        <div style="font-size:11px;color:var(--text);line-height:1.6">
          ✦ <strong>Mantenimiento Correctivo</strong> — se reparan cuando se rompen<br>
          ✦ <strong>Run-to-Failure</strong> — no gastar presupuesto preventivo aquí<br>
          ✦ Sin stock de repuestos dedicado en planta
        </div>
      </div>
    </div>
  </div>

  <!-- TABLE -->
  <div class="table-card">
    <div class="table-header">
      <span class="card-title" style="margin:0">Inventario de Equipos</span>
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <span class="tbl-count" id="tblCount"></span>
        <input type="text" class="search-box" id="searchBox" placeholder="Buscar TAG, elemento, sector...">
      </div>
    </div>
    <div class="table-wrap">
      <table id="equipTable">
        <thead>
          <tr>
            <th data-col="item">#</th>
            <th data-col="tag">TAG</th>
            <th data-col="elemento">Elemento</th>
            <th data-col="sector">Sector</th>
            <th data-col="prod">Para Prod.</th>
            <th data-col="c1">C1 (50%)</th>
            <th data-col="c2">C2 (30%)</th>
            <th data-col="c3">C3 (20%)</th>
            <th data-col="ic">IC ↓</th>
            <th data-col="crit">Clase</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>
</div>

<div id="tooltip"></div>

<script>
// ============================================================
// DATA — TAG actualizado desde Excel v2
// ============================================================
const rawData = [
  {item:1,tag:"MOL-CJ-02",elemento:"CAJON 2",sector:"Molienda",prod:"NO",c1:3,c2:3,c3:2,ic:2.8,crit:"B"},
  {item:2,tag:"MOL-CN-0,1",elemento:"Cinta 0,1",sector:"Molienda",prod:"NO",c1:2,c2:3,c3:1,ic:2.1,crit:"C"},
  {item:3,tag:"MOL-CN-1,1",elemento:"Cinta 1,1",sector:"Molienda",prod:"NO",c1:2,c2:3,c3:1,ic:2.1,crit:"C"},
  {item:4,tag:"MOL-CN-1,2",elemento:"Cinta 1,2",sector:"Molienda",prod:"NO",c1:2,c2:3,c3:1,ic:2.1,crit:"C"},
  {item:5,tag:"MOL-CN-02",elemento:"Cinta 2",sector:"Molienda",prod:"NO",c1:2,c2:3,c3:1,ic:2.1,crit:"C"},
  {item:6,tag:"MOL-RT-01",elemento:"Rotofiltro",sector:"Molienda",prod:"NO",c1:2,c2:3,c3:1,ic:2.1,crit:"C"},
  {item:7,tag:"MOL-CN-16",elemento:"Cinta 16",sector:"Molienda",prod:"NO",c1:2,c2:3,c3:1,ic:2.1,crit:"C"},
  {item:8,tag:"MOL-CN-05",elemento:"Cinta 5",sector:"Molienda",prod:"NO",c1:2,c2:3,c3:1,ic:2.1,crit:"C"},
  {item:9,tag:"MOL-CN-06",elemento:"Cinta 6",sector:"Molienda",prod:"NO",c1:2,c2:3,c3:1,ic:2.1,crit:"C"},
  {item:10,tag:"MOL-CN-03",elemento:"Cinta 3",sector:"Molienda",prod:"NO",c1:2,c2:3,c3:1,ic:2.1,crit:"C"},
  {item:11,tag:"MOL-CN-07",elemento:"Cinta 7",sector:"Molienda",prod:"NO",c1:2,c2:3,c3:1,ic:2.1,crit:"C"},
  {item:12,tag:"MOL-CN-08",elemento:"Cinta 8",sector:"Molienda",prod:"NO",c1:2,c2:3,c3:1,ic:2.1,crit:"C"},
  {item:13,tag:"MOL-CN-1210",elemento:"Cinta niveladora LM1210",sector:"Molienda",prod:"NO",c1:2,c2:3,c3:1,ic:2.1,crit:"C"},
  {item:14,tag:"MOL-LM-1210",elemento:"Laminador LM1210",sector:"Molienda",prod:"NO",c1:2,c2:4,c3:2,ic:2.6,crit:"B"},
  {item:15,tag:"MOL-FM-01",elemento:"Filtro de Manga",sector:"Molienda",prod:"NO",c1:1,c2:3,c3:1,ic:1.6,crit:"C"},
  {item:16,tag:"MOL-CN-09",elemento:"Cinta 9",sector:"Molienda",prod:"NO",c1:2,c2:3,c3:1,ic:2.1,crit:"C"},
  {item:17,tag:"MOL-MEZ-710I",elemento:"Mezcladora MIX 710I",sector:"Molienda",prod:"NO",c1:3,c2:4,c3:4,ic:3.5,crit:"B"},
  {item:18,tag:"MOL-CN-10",elemento:"Cinta 10",sector:"Molienda",prod:"NO",c1:2,c2:3,c3:1,ic:2.1,crit:"C"},
  {item:19,tag:"MOL-CN-12",elemento:"Cinta 12",sector:"Molienda",prod:"NO",c1:3,c2:3,c3:2,ic:2.8,crit:"B"},
  {item:20,tag:"MOL-CN-11",elemento:"Cinta 11",sector:"Molienda",prod:"NO",c1:1,c2:3,c3:1,ic:1.6,crit:"C"},
  {item:21,tag:"SIL-CJ-01",elemento:"CAJON 1",sector:"Silo",prod:"NO",c1:3,c2:3,c3:2,ic:2.8,crit:"B"},
  {item:22,tag:"SIL-CN-3A",elemento:"PC3A",sector:"Silo",prod:"NO",c1:2,c2:4,c3:2,ic:2.6,crit:"B"},
  {item:23,tag:"SIL-CN-3B",elemento:"PC3B",sector:"Silo",prod:"NO",c1:2,c2:4,c3:2,ic:2.6,crit:"B"},
  {item:24,tag:"SIL-CN-05",elemento:"PC5",sector:"Silo",prod:"NO",c1:2,c2:4,c3:2,ic:2.6,crit:"B"},
  {item:25,tag:"SIL-CN-04",elemento:"PC4",sector:"Silo",prod:"NO",c1:2,c2:4,c3:2,ic:2.6,crit:"B"},
  {item:26,tag:"SIL-CN-01",elemento:"PC1",sector:"Silo",prod:"NO",c1:2,c2:4,c3:2,ic:2.6,crit:"B"},
  {item:27,tag:"SIL-CN-06",elemento:"PC6",sector:"Silo",prod:"NO",c1:2,c2:4,c3:2,ic:2.6,crit:"B"},
  {item:28,tag:"SIL-CN-02",elemento:"PC2",sector:"Silo",prod:"NO",c1:2,c2:4,c3:2,ic:2.6,crit:"B"},
  {item:29,tag:"SIL-CN-07",elemento:"PC7",sector:"Silo",prod:"NO",c1:2,c2:4,c3:2,ic:2.6,crit:"B"},
  {item:30,tag:"PRO-CJ-03",elemento:"CAJON 3",sector:"Produccion",prod:"SI",c1:5,c2:4,c3:2,ic:4.1,crit:"A"},
  {item:31,tag:"PRO-CN-27",elemento:"Cinta 27",sector:"Produccion",prod:"SI",c1:5,c2:3,c3:1,ic:3.6,crit:"B"},
  {item:32,tag:"PRO-CN-KLB12",elemento:"Cinta niveladora KLB12",sector:"Produccion",prod:"SI",c1:5,c2:3,c3:1,ic:3.6,crit:"B"},
  {item:33,tag:"PRO-LM-KLB12",elemento:"Laminador KLB12",sector:"Produccion",prod:"NO",c1:2,c2:5,c3:3,ic:3.1,crit:"B"},
  {item:34,tag:"PRO-FM-02",elemento:"Filtro de manga Prod",sector:"Produccion",prod:"NO",c1:1,c2:3,c3:1,ic:1.6,crit:"C"},
  {item:35,tag:"PRO-CN-28",elemento:"Cinta 28",sector:"Produccion",prod:"SI",c1:5,c2:3,c3:1,ic:3.6,crit:"B"},
  {item:36,tag:"PRO-CN-4",elemento:"Cinta 4",sector:"Produccion",prod:"SI",c1:5,c2:3,c3:1,ic:3.6,crit:"B"},
  {item:37,tag:"PRO-CN-29",elemento:"Cinta 29",sector:"Produccion",prod:"SI",c1:5,c2:3,c3:1,ic:3.6,crit:"B"},
  {item:38,tag:"PRO-BV-01",elemento:"Bomba Vacio",sector:"Produccion",prod:"SI",c1:5,c2:5,c3:3,ic:4.6,crit:"A"},
  {item:39,tag:"PRO-MEZ-710D",elemento:"Mezcladora MIX710D",sector:"Produccion",prod:"SI",c1:5,c2:4,c3:2,ic:4.1,crit:"A"},
  {item:40,tag:"PRO-EX-750",elemento:"Extrusora Tecno 750",sector:"Produccion",prod:"SI",c1:5,c2:5,c3:3,ic:4.6,crit:"A"},
  {item:41,tag:"PRO-CN-30",elemento:"Cinta 30",sector:"Produccion",prod:"SI-NO",c1:3,c2:3,c3:1,ic:2.6,crit:"B"},
  {item:42,tag:"PRO-CN-31",elemento:"Cinta 31",sector:"Produccion",prod:"SI-NO",c1:3,c2:3,c3:1,ic:2.6,crit:"B"},
  {item:43,tag:"PRO-CN-32",elemento:"Cinta 32",sector:"Produccion",prod:"SI-NO",c1:3,c2:3,c3:1,ic:2.6,crit:"B"},
  {item:44,tag:"PRO-CN-33",elemento:"Cinta 33",sector:"Produccion",prod:"SI-NO",c1:3,c2:3,c3:1,ic:2.6,crit:"B"},
  {item:45,tag:"CV-ACV-V126",elemento:"Linea automatismo Carga Verde",sector:"Carga Verde",prod:"SI",c1:5,c2:3,c3:2,ic:3.8,crit:"B"},
  {item:46,tag:"SEC-AIS-V124",elemento:"Linea automatismo Ingreso Secadero",sector:"Secadero",prod:"SI",c1:5,c2:3,c3:2,ic:3.8,crit:"B"},
  {item:47,tag:"SEC-VExtHum-03",elemento:"Ventiladores extraccion humedo (x3)",sector:"Secadero",prod:"NO",c1:2,c2:3,c3:1,ic:2.1,crit:"C"},
  {item:48,tag:"SEC-VSec-120",elemento:"Ventiladores (x120)",sector:"Secadero",prod:"NO",c1:1,c2:2,c3:2,ic:1.5,crit:"C"},
  {item:49,tag:"SEC-CarVent-03",elemento:"Carros de ventilacion",sector:"Secadero",prod:"NO",c1:2,c2:3,c3:2,ic:2.3,crit:"C"},
  {item:50,tag:"SEC-ASS-V124",elemento:"Linea automatismo Salida Secadero V12",sector:"Secadero",prod:"SI",c1:5,c2:3,c3:2,ic:3.8,crit:"B"},
  {item:51,tag:"DS-ADS-V126",elemento:"Linea automatismo Descarga Seco",sector:"Descarga Seco",prod:"SI",c1:4,c2:3,c3:2,ic:3.3,crit:"B"},
  {item:52,tag:"AP-API-V125",elemento:"Linea automatismo Apiladora / Carga seco",sector:"Apiladora",prod:"SI",c1:4,c2:3,c3:2,ic:3.3,crit:"B"},
  {item:53,tag:"HOR-AIH-V123",elemento:"Linea automatismo Ingreso Horno",sector:"Horno",prod:"SI",c1:5,c2:3,c3:2,ic:3.8,crit:"B"},
  {item:54,tag:"HOR-VHum-01",elemento:"Ventilador Humos",sector:"Horno",prod:"SI",c1:4,c2:5,c3:2,ic:3.9,crit:"B"},
  {item:55,tag:"HOR-VRec-02",elemento:"Ventilador Recirculacion 1 y 2",sector:"Horno",prod:"NO",c1:1,c2:3,c3:2,ic:1.8,crit:"C"},
  {item:56,tag:"HOR-QLAT-12",elemento:"Quemadores laterales (x12)",sector:"Horno",prod:"NO",c1:2,c2:3,c3:2,ic:2.3,crit:"C"},
  {item:57,tag:"HOR-VEnfBob-01",elemento:"Ventilador Enfriamiento boveda pre horno",sector:"Horno",prod:"NO",c1:1,c2:3,c3:2,ic:1.8,crit:"C"},
  {item:58,tag:"HOR-QSUP-13",elemento:"Quemadores Superiores (x13)",sector:"Horno",prod:"NO",c1:2,c2:2,c3:1,ic:1.8,crit:"C"},
  {item:59,tag:"HOR-VEnfRap-02",elemento:"Ventiladores Enfriamiento rapidos (x2)",sector:"Horno",prod:"NO",c1:2,c2:3,c3:2,ic:2.3,crit:"C"},
  {item:60,tag:"HOR-VInyAirVag-01",elemento:"Ventilador Iny. aire frio bajo vagoneta",sector:"Horno",prod:"NO",c1:1,c2:1,c3:2,ic:1.2,crit:"C"},
  {item:61,tag:"HOR-VBajVag-01",elemento:"Ventilador Bajo vagoneta",sector:"Horno",prod:"NO",c1:2,c2:3,c3:2,ic:2.3,crit:"C"},
  {item:62,tag:"HOR-VRecAlt-01",elemento:"Ventilador Rec Alta",sector:"Horno",prod:"NO",c1:2,c2:3,c3:2,ic:2.3,crit:"C"},
  {item:63,tag:"HOR-VRecBaj-01",elemento:"Ventilador Rec Baja",sector:"Horno",prod:"NO",c1:2,c2:3,c3:2,ic:2.3,crit:"C"},
  {item:64,tag:"HOR-VEnfBovSec-02",elemento:"Ventiladores enfriamiento bov a secadero (x2)",sector:"Horno",prod:"NO",c1:2,c2:3,c3:2,ic:2.3,crit:"C"},
  {item:65,tag:"HOR-VCont-01",elemento:"Ventilador Contrapresion",sector:"Horno",prod:"SI",c1:4,c2:5,c3:2,ic:3.9,crit:"B"},
  {item:66,tag:"HOR-ASH-V123",elemento:"Linea automatismo Salida horno",sector:"Horno",prod:"SI-NO",c1:4,c2:3,c3:2,ic:3.3,crit:"B"},
  {item:67,tag:"DC-ADC-V128",elemento:"Linea automatismo Descarga Cocido",sector:"Horno",prod:"SI-NO",c1:4,c2:3,c3:2,ic:3.3,crit:"B"},
  {item:68,tag:"SEC-CalZon-02",elemento:"Calentadores de gas a secadero (x2)",sector:"Secadero",prod:"NO",c1:3,c2:4,c3:1,ic:2.9,crit:"B"},
  {item:69,tag:"SEC-VInyAirSec-02",elemento:"Ventiladores inyeccion aire a secadero (x2)",sector:"Secadero",prod:"NO",c1:4,c2:4,c3:1,ic:3.4,crit:"B"},
  {item:70,tag:"AUX-CA-01",elemento:"Compresor de aire",sector:"Auxiliar",prod:"SI",c1:5,c2:4,c3:2,ic:4.1,crit:"A"},
  {item:71,tag:"AUX-LM-01",elemento:"Lavamolde",sector:"Auxiliar",prod:"NO",c1:1,c2:4,c3:1,ic:1.9,crit:"C"},
  {item:72,tag:"SEC-Zorr-222",elemento:"Zorra",sector:"Secadero",prod:"NO",c1:1,c2:1,c3:2,ic:1.2,crit:"C"},
  {item:73,tag:"HOR-Vag-95",elemento:"Vagonetas",sector:"Horno",prod:"NO",c1:1,c2:1,c3:2,ic:1.2,crit:"C"},
  {item:74,tag:"AUX-GE-01",elemento:"Grupo electrogeno",sector:"Auxiliar",prod:"NO",c1:2,c2:3,c3:2,ic:2.3,crit:"C"},
];

const colorMap = { A:'#ff3b5c', B:'#ffaa00', C:'#00d68f' };
const sectors = [...new Set(rawData.map(d=>d.sector))].sort();

let activeFilters = { sector:'todos', crit:'todos-crit' };
let sortState = { col:'ic', dir:'desc' };
let searchTerm = '';
let highlightedItem = null;
let bubbleChart, sectorChart;

// ── FILTERS ──────────────────────────────────────────────────
function buildSectorFilters() {
  const cont = document.getElementById('filters');
  const allBtn = cont.querySelector('[data-val="todos"]');
  sectors.forEach(s => {
    const btn = document.createElement('button');
    btn.className = 'filter-btn';
    btn.dataset.filter = 'sector';
    btn.dataset.val = s;
    btn.textContent = s;
    allBtn.parentNode.insertBefore(btn, allBtn.nextSibling.nextSibling);
  });

  cont.addEventListener('click', e => {
    const btn = e.target.closest('.filter-btn'); if (!btn) return;
    const { filter, val } = btn.dataset;
    activeFilters[filter] = val;
    cont.querySelectorAll(`[data-filter="${filter}"]`).forEach(b => {
      b.classList.remove('active','active-A','active-B','active-C');
    });
    if (filter === 'crit' && val !== 'todos-crit') btn.classList.add(`active-${val}`);
    else btn.classList.add('active');
    updateAll();
  });
  // init crit "Todas" active
  cont.querySelector('[data-val="todos-crit"]').classList.add('active');
}

function getFiltered() {
  return rawData.filter(d => {
    if (activeFilters.sector !== 'todos' && d.sector !== activeFilters.sector) return false;
    if (activeFilters.crit !== 'todos-crit' && d.crit !== activeFilters.crit) return false;
    if (searchTerm) {
      const s = searchTerm.toLowerCase();
      if (!d.tag.toLowerCase().includes(s) && !d.elemento.toLowerCase().includes(s) && !d.sector.toLowerCase().includes(s)) return false;
    }
    return true;
  });
}

// ── BUBBLE CHART ─────────────────────────────────────────────
function initBubble() {
  const ctx = document.getElementById('bubbleChart').getContext('2d');
  bubbleChart = new Chart(ctx, {
    type: 'bubble',
    data: { datasets: [] },
    options: {
      responsive: true, maintainAspectRatio: false,
      animation: { duration: 400 },
      scales: {
        x: {
          title: { display: true, text: 'C1 — Impacto en Producción (1=mínimo · 5=parada total inmediata)', color: '#7a839e', font: { size: 11 } },
          min: 0.5, max: 5.5,
          ticks: { color: '#7a839e', stepSize: 1 },
          grid: { color: 'rgba(42,51,80,0.5)' },
          border: { color: '#2a3350' }
        },
        y: {
          title: { display: true, text: 'C2 — Costo y Complejidad (1=simple/barata · 5=repuesto capital)', color: '#7a839e', font: { size: 11 } },
          min: 0.5, max: 5.5,
          ticks: { color: '#7a839e', stepSize: 1 },
          grid: { color: 'rgba(42,51,80,0.5)' },
          border: { color: '#2a3350' }
        }
      },
      plugins: { legend: { display: false }, tooltip: { enabled: false } },
      onHover: (evt, els) => {
        if (els.length) showTooltip(evt.native, els[0].element.$context.raw._data);
        else hideTooltip();
      },
      onClick: (evt, els) => {
        if (els.length) {
          highlightedItem = els[0].element.$context.raw._data.item;
          buildTable();
          setTimeout(() => {
            const row = document.querySelector(`tr[data-item="${highlightedItem}"]`);
            if (row) row.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }, 50);
        }
      }
    }
  });
  updateBubble();
}

function updateBubble() {
  const f = getFiltered();
  const groups = { A:[], B:[], C:[] };
  f.forEach(d => {
    groups[d.crit].push({
      x: d.c1 + (Math.random()-0.5)*0.14,
      y: d.c2 + (Math.random()-0.5)*0.14,
      r: d.c3 * 5.5 + 8,
      _data: d
    });
  });
  bubbleChart.data.datasets = Object.entries(groups).map(([crit, pts]) => ({
    data: pts,
    backgroundColor: colorMap[crit] + '66',
    borderColor: colorMap[crit] + 'cc',
    borderWidth: 1.5,
    hoverBackgroundColor: colorMap[crit] + 'bb',
    hoverBorderWidth: 2.5,
  }));
  bubbleChart.update();
}

// ── HEAT MAP ─────────────────────────────────────────────────
function buildHeatmap() {
  const counts = {};
  rawData.forEach(d => { const k=`${d.c1}_${d.c2}`; counts[k]=(counts[k]||0)+1; });
  const max = Math.max(...Object.values(counts));
  let html = '<div class="heat-matrix">';
  // r = C2 (eje Y, de 5 arriba a 1 abajo), c = C1 (eje X, de 1 a 5)
  for (let r=5; r>=1; r--) {
    html += `<div class="hm-axis y">${r}</div>`;
    for (let c=1; c<=5; c++) {
      const k = `${c}_${r}`;
      const n = counts[k]||0;
      // Colorear la zona según IC = C1*0.5 + C2*0.3 + C3_prom*0.2
      // Usamos C3 promedio ~1.8 para representar la zona
      const icZone = c*0.5 + r*0.3 + 1.8*0.2;
      const col = icZone >= 4.0 ? '#ff3b5c' : icZone >= 2.5 ? '#ffaa00' : '#00d68f';
      const alpha = n>0 ? 0.18+(n/max)*0.6 : 0.08;
      const ri=parseInt(col.slice(1,3),16), gi=parseInt(col.slice(3,5),16), bi=parseInt(col.slice(5,7),16);
      const bg=`rgba(${ri},${gi},${bi},${alpha})`;
      const txt=n>0?col:`rgba(${ri},${gi},${bi},0.3)`;
      const border=`rgba(${ri},${gi},${bi},${n>0?0.45:0.15})`;
      html += `<div class="hm-cell" style="background:${bg};color:${txt};border:1px solid ${border}"
        title="C1=${c} · C2=${r} — ${n} equipo${n!==1?'s':''}\nIC ≈ ${icZone.toFixed(1)}">${n||''}</div>`;
    }
  }
  html += '<div></div>';
  for (let c=1;c<=5;c++) html += `<div class="hm-axis">${c}</div>`;
  html += '</div>';
  document.getElementById('heatmap').innerHTML = html;
}

// ── SECTOR DONUT ─────────────────────────────────────────────
function initSectorChart() {
  const ctx = document.getElementById('sectorChart').getContext('2d');
  const sectorColors = {
    'Molienda':'#3b7cff','Horno':'#f97316','Produccion':'#a855f7',
    'Silo':'#22d3ee','Secadero':'#eab308','Auxiliar':'#94a3b8',
    'Carga Verde':'#4ade80','Descarga Seco':'#fb7185','Apiladora':'#f0abfc'
  };
  const counts = {};
  rawData.forEach(d => { counts[d.sector]=(counts[d.sector]||0)+1; });
  const labels = Object.keys(counts);
  sectorChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels,
      datasets: [{
        data: labels.map(l=>counts[l]),
        backgroundColor: labels.map(l=>(sectorColors[l]||'#888')+'bb'),
        borderColor: labels.map(l=>sectorColors[l]||'#888'),
        borderWidth: 1.5
      }]
    },
    options: {
      responsive: true, maintainAspectRatio: false, cutout: '58%',
      plugins: {
        legend: { display: true, position: 'right', labels: { color:'#7a839e', font:{size:9}, boxWidth:10, padding:6 } },
        tooltip: { backgroundColor:'#1e2535', borderColor:'#3a4560', borderWidth:1, titleColor:'#e8eaf2', bodyColor:'#7a839e' }
      }
    }
  });
}

// ── TABLE ─────────────────────────────────────────────────────
function buildTable() {
  let data = getFiltered();
  data = [...data].sort((a,b) => {
    const v = sortState.dir==='asc'?1:-1;
    if (sortState.col==='ic'||sortState.col==='c1'||sortState.col==='c2'||sortState.col==='c3'||sortState.col==='item')
      return (a[sortState.col]-b[sortState.col])*v;
    return a[sortState.col]<b[sortState.col]?-v:a[sortState.col]>b[sortState.col]?v:0;
  });

  const c1Desc = ['','Insignificante','Menor','Moderado','Alto','Crítico'];
  const c2Desc = ['','Bajo','Medio-Bajo','Medio','Alto','Muy Alto'];
  const c3Desc = ['','Muy Baja','Baja','Media','Alta','Crónica'];

  const tbody = document.getElementById('tableBody');
  tbody.innerHTML = data.map(d => {
    const pct = ((d.ic-1.2)/(4.6-1.2)*100).toFixed(0);
    const col = colorMap[d.crit];
    const prodHtml = d.prod==='SI'
      ? `<span class="prod-si">● SI</span>`
      : d.prod==='SI-NO'
      ? `<span class="prod-sino">◑ SI/NO</span>`
      : `<span class="prod-no">○ NO</span>`;
    return `<tr data-item="${d.item}" class="${highlightedItem===d.item?'highlighted':''}">
      <td style="color:var(--text-dim)">${d.item}</td>
      <td class="tag-mono">${d.tag}</td>
      <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;font-size:12px" title="${d.elemento}">${d.elemento}</td>
      <td><span class="sector-pill">${d.sector}</span></td>
      <td>${prodHtml}</td>
      <td style="text-align:center;color:${d.c1>=4?'#f97316':d.c1===1?'var(--text-dim)':'var(--text)'}" title="${c1Desc[d.c1]}">${d.c1}</td>
      <td style="text-align:center;color:${d.c2>=4?'#f97316':d.c2===1?'var(--text-dim)':'var(--text)'}" title="${c2Desc[d.c2]}">${d.c2}</td>
      <td style="text-align:center;color:${d.c3>=3?'#f97316':d.c3===1?'var(--text-dim)':'var(--text)'}" title="${c3Desc[d.c3]}">${d.c3}</td>
      <td>
        <div class="ic-bar">
          <div class="ic-track"><div class="ic-fill" style="width:${pct}%;background:${col}"></div></div>
          <span style="font-weight:600;color:${col};font-size:12px">${d.ic}</span>
        </div>
      </td>
      <td><span class="badge badge-inline-${d.crit}">${d.crit}</span></td>
    </tr>`;
  }).join('');

  document.getElementById('tblCount').textContent = `${data.length} / ${rawData.length} equipos`;

  document.querySelectorAll('thead th').forEach(th => {
    th.classList.remove('sort-asc','sort-desc');
    if (th.dataset.col===sortState.col) th.classList.add(sortState.dir==='asc'?'sort-asc':'sort-desc');
  });
}

document.querySelector('thead').addEventListener('click', e => {
  const th = e.target.closest('th'); if (!th||!th.dataset.col) return;
  if (sortState.col===th.dataset.col) sortState.dir=sortState.dir==='asc'?'desc':'asc';
  else { sortState.col=th.dataset.col; sortState.dir='desc'; }
  buildTable();
});

document.getElementById('tableBody').addEventListener('click', e => {
  const row = e.target.closest('tr'); if (!row) return;
  highlightedItem = parseInt(row.dataset.item);
  buildTable();
});

document.getElementById('searchBox').addEventListener('input', e => {
  searchTerm = e.target.value;
  updateAll();
});

// ── TOOLTIP ──────────────────────────────────────────────────
const c1Labels=['','Insignificante — sin efecto en producción','Menor — leve reducción, no para la línea','Moderado — parte se detiene, buffers > 4h','Alto — parada con pulmón < 1h o descarte masivo','Crítico — PARADA TOTAL INMEDIATA'];
const c2Labels=['','Bajo — reparación < USD 100, genérico','Medio-Bajo — repuestos estándar, < 2h','Medio — repuesto específico, 4–8h','Alto — repuesto costoso o MOE externa','Muy Alto — repuesto capital, tiempos largos'];
const c3Labels=['','Muy Baja — < 1 vez al año','Baja — 1–2 veces al año','Media — 1 vez por trimestre','Alta — 1 vez al mes','Crónica — falla semanal o diaria'];

function showTooltip(evt, d) {
  const col = colorMap[d.crit];
  document.getElementById('tooltip').innerHTML = `
    <div class="tt-tag" style="color:${col}">${d.tag}</div>
    <div class="tt-name">${d.elemento}<br>${d.sector}</div>
    <div class="tt-row"><span class="tt-key">C1 Producción</span><span class="tt-val" style="color:${d.c1>=4?'#f97316':''}">
      ${d.c1} — ${['','Insig.','Menor','Moderado','Alto','Crítico'][d.c1]}</span></div>
    <div class="tt-row"><span class="tt-key">C2 Costo/Comp.</span><span class="tt-val" style="color:${d.c2>=4?'#f97316':''}">
      ${d.c2} — ${['','Bajo','Med-Bajo','Medio','Alto','Muy Alto'][d.c2]}</span></div>
    <div class="tt-row"><span class="tt-key">C3 Frecuencia</span><span class="tt-val" style="color:${d.c3>=3?'#f97316':''}">
      ${d.c3} — ${['','Muy Baja','Baja','Media','Alta','Crónica'][d.c3]}</span></div>
    <div class="tt-row"><span class="tt-key">IC</span><span class="tt-val" style="color:${col}">${d.ic}</span></div>
    <div class="tt-row"><span class="tt-key">Clase</span><span class="tt-val" style="color:${col}">${d.crit}</span></div>
    <div class="tt-row"><span class="tt-key">Para Prod.</span><span class="tt-val">${d.prod}</span></div>
  `;
  document.getElementById('tooltip').style.display = 'block';
  const x = Math.min(evt.clientX+16, window.innerWidth-250);
  const y = Math.min(evt.clientY-10, window.innerHeight-210);
  document.getElementById('tooltip').style.left = x+'px';
  document.getElementById('tooltip').style.top = y+'px';
}

function hideTooltip() { document.getElementById('tooltip').style.display = 'none'; }

// ── UPDATE ALL ────────────────────────────────────────────────
function updateAll() {
  updateBubble();
  buildTable();
}

// ── INIT ─────────────────────────────────────────────────────
buildSectorFilters();
buildHeatmap();
initBubble();
initSectorChart();
buildTable();

// ── GOOGLE SHEETS SYNC ───────────────────────────────────────
const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/1ttnwascASYLm9-UxEPZIOKW8YgPE-CSmX7G57XMNEqM/pub?output=csv&gid=0';

async function syncFromSheets() {
  const btn = document.getElementById('syncBtn');
  btn.innerHTML = '<span class="spin">↻</span> Actualizando...';
  btn.disabled = true;

  // Multiple proxy strategies in order of preference
  const strategies = [
    // 1. Direct fetch (works if CORS is open — Google Sheets published CSVs sometimes allow it)
    async () => {
      const res = await fetch(SHEET_CSV_URL, { mode: 'cors', cache: 'no-cache' });
      if (!res.ok) throw new Error('direct failed');
      return await res.text();
    },
    // 2. allorigins.win
    async () => {
      const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(SHEET_CSV_URL)}`, { cache: 'no-cache' });
      if (!res.ok) throw new Error('allorigins failed');
      const j = await res.json();
      if (!j.contents) throw new Error('allorigins empty');
      return j.contents;
    },
    // 3. corsproxy.io
    async () => {
      const res = await fetch(`https://corsproxy.io/?${encodeURIComponent(SHEET_CSV_URL)}`, { cache: 'no-cache' });
      if (!res.ok) throw new Error('corsproxy failed');
      return await res.text();
    },
    // 4. thingproxy
    async () => {
      const res = await fetch(`https://thingproxy.freeboard.io/fetch/${SHEET_CSV_URL}`, { cache: 'no-cache' });
      if (!res.ok) throw new Error('thingproxy failed');
      return await res.text();
    }
  ];

  let csv = null;
  let lastError = null;
  let proxyUsed = '';

  const strategyNames = ['Directo', 'allorigins.win', 'corsproxy.io', 'thingproxy'];
  for (let si = 0; si < strategies.length; si++) {
    try {
      csv = await strategies[si]();
      if (csv && csv.length > 50) { proxyUsed = strategyNames[si]; break; }
    } catch(e) {
      lastError = e;
      console.warn(`[${strategyNames[si]}] falló:`, e.message);
    }
  }
  console.log('Proxy usado:', proxyUsed, '| CSV length:', csv?.length);

  try {
    if (!csv || csv.length < 50) throw new Error('Todos los proxies fallaron: ' + lastError?.message);

    console.log('=== CSV RAW (primeras 500 chars) ===');
    console.log(csv.substring(0, 500));
    console.log('=== LINEAS ===');
    csv.split('\n').slice(0,5).forEach((l,i) => console.log(`Linea ${i}: ${l}`));

    const parsed = parseCSV(csv);
    console.log('=== PARSED ===', parsed.length, 'registros', parsed[0]);
    if (!parsed.length) throw new Error('CSV vacío o sin datos reconocibles');

    rawData.length = 0;
    parsed.forEach(r => rawData.push(r));

    // Full re-render
    document.getElementById('filters').innerHTML = '';
    buildSectorFilters();
    buildHeatmap();
    if (bubbleChart) bubbleChart.destroy();
    if (sectorChart) sectorChart.destroy();
    initBubble();
    initSectorChart();
    activeFilters = { sector:'todos', crit:'todos-crit' };
    searchTerm = '';
    highlightedItem = null;
    buildTable();
    updateStats();

    const ts = new Date().toLocaleTimeString('es-AR', {hour:'2-digit', minute:'2-digit'});
    showToast(`✔ ${rawData.length} equipos actualizados — ${ts}`, 'ok');
  } catch(e) {
    console.error(e);
    showToast('✖ No se pudo leer el Sheet. Verificá que esté publicado como CSV.', 'err');
  } finally {
    btn.innerHTML = '⟳ Actualizar desde Sheets';
    btn.disabled = false;
  }
}

function parseCSV(csv) {
  // Split lines, keep empty to preserve row positions
  const allLines = csv.split('\n').map(l => l.trim());

  // Find header row — contains both "TAG" and "Elemento"
  let headerIdx = -1;
  for (let i = 0; i < Math.min(10, allLines.length); i++) {
    const u = allLines[i].toUpperCase();
    if (u.includes('TAG') && u.includes('ELEMENTO')) { headerIdx = i; break; }
  }
  if (headerIdx === -1) {
    console.error('No se encontró fila de encabezados'); return [];
  }

  console.log('Header row idx:', headerIdx, '→', allLines[headerIdx]);

  // Parse header — normalize accents and special chars
  const norm = s => s.trim().toLowerCase()
    .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
    .replace(/[^a-z0-9]/g,' ').trim();

  const headers = allLines[headerIdx].split(',').map(norm);
  console.log('Headers:', headers);

  // Find column indices by keyword match
  const find = (...keys) => {
    for (const k of keys) {
      const idx = headers.findIndex(h => h.includes(k));
      if (idx >= 0) return idx;
    }
    return -1;
  };

  const iItem   = find('item');
  const iTag    = find('tag');
  const iElem   = find('elemento', 'element');
  const iSector = find('sector');
  const iProd   = find('para', 'prod');
  const iC1     = find('c1', '50');
  const iC2     = find('c2', '30');
  const iC3     = find('c3', '20');
  const iIc     = find('ic');
  const iCrit   = find('criticidad', 'crit', 'clase');

  console.log('Col indices → tag:', iTag, 'elem:', iElem, 'sector:', iSector,
    'c1:', iC1, 'c2:', iC2, 'c3:', iC3, 'ic:', iIc, 'crit:', iCrit);

  const get = (parts, idx) => idx >= 0 && parts[idx] !== undefined ? parts[idx].trim().replace(/^"|"$/g,'') : '';

  const results = [];
  for (let i = headerIdx + 1; i < allLines.length; i++) {
    const line = allLines[i];
    if (!line) continue;
    const parts = line.split(',');
    const tag = get(parts, iTag);
    if (!tag) continue;

    const c1   = parseFloat(get(parts, iC1)) || 1;
    const c2   = parseFloat(get(parts, iC2)) || 1;
    const c3   = parseFloat(get(parts, iC3)) || 1;
    const ic   = parseFloat(get(parts, iIc)) || parseFloat((c1*0.5 + c2*0.3 + c3*0.2).toFixed(1));
    const rawC = get(parts, iCrit).toUpperCase().replace(/[^ABC]/g,'');
    const crit = ['A','B','C'].includes(rawC) ? rawC : (ic >= 4 ? 'A' : ic >= 2.5 ? 'B' : 'C');

    results.push({
      item:     parseInt(get(parts, iItem)) || i,
      tag,
      elemento: get(parts, iElem) || tag,
      sector:   get(parts, iSector) || 'Sin sector',
      prod:     get(parts, iProd) || 'NO',
      c1, c2, c3, ic, crit
    });
  }
  console.log('Parsed records:', results.length, results[0]);
  return results;
}

function updateStats() {
  const nums = document.querySelectorAll('.stat-num');
  const a = rawData.filter(d=>d.crit==='A').length;
  const b = rawData.filter(d=>d.crit==='B').length;
  const c = rawData.filter(d=>d.crit==='C').length;
  const maxIc = rawData.length ? Math.max(...rawData.map(d=>d.ic)).toFixed(1) : '-';
  if (nums[0]) nums[0].textContent = a;
  if (nums[1]) nums[1].textContent = b;
  if (nums[2]) nums[2].textContent = c;
  if (nums[3]) nums[3].textContent = maxIc;
}

let toastTimer;
function showToast(msg, type='info') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = `show ${type}`;
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => { t.className = type; }, 4500);
}
</script>
<div id="toast"></div>
</body>
</html>
